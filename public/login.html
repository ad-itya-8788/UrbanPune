<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Title & Description -->
  <title>Urban Pune - Find Verified Rooms, Hostels & Flats in Pune</title>
  <meta name="description"
    content="Urban Pune helps students and professionals find verified hostels, PGs, rooms, flats, 1BHK, 2BHK, and hotels in prime Pune areas like Karve Nagar, Kothrud, FC Road, Viman Nagar & more." />
  <meta name="keywords"
    content="Pune rooms, hostels in Pune, PG Pune, Pune flat rent, Karve Nagar hostel, Kothrud rooms, Pune rental, student room Pune, urban pune, FC road PG, girls hostel Pune, boys PG Pune, Viman Nagar rent, affordable room Pune, verified PG Pune, furnished flats Pune, shared room Pune, hostel near Pune college, MIT WPU hostel, SP College room, Pune student accommodation, UrbanPune.in, apartments in Pune, rent room Pune, college hostel Pune, cheap hostel Pune, mess Pune, room for students Pune, single room Pune, Pune shared accommodation, rent near Karve Nagar, rent near FC Road, rent near Kothrud, rooms near MIT, rooms near SP College, Urban Pune login, Urban Pune register, trusted PG Pune, Pune PG boys, Pune PG girls, safe room Pune, room with food Pune, student flat Pune, Pune PG with AC, Urban Pune verified listings, rental room app Pune, Pune accommodation website, best PG Pune, punehostel, roomrentalpune, hostelbookingpune, puneflats, hotels in Pune, 1BHK Pune, 2BHK Pune, flats for rent Pune, properties for rent Pune, PGs in Pune, furnished properties Pune, Pune hotel rooms, affordable flats Pune, Pune property listings, rent 1BHK Pune, rent 2BHK Pune, flats for working professionals Pune, hostels near FC Road Pune, PG for rent in Karve Nagar, Pune property agents, 1BHK 2BHK PG in Pune, student housing Pune, verified flats Pune" />
  <meta name="author" content="Urban Pune" />
  <meta name="robots" content="index, follow" />
  
  <!-- Favicon -->
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.urbanpune.in/" />
  <meta property="og:title" content="Urban Pune - Verified Rooms, Hostels, PGs, Flats & Hotels in Pune" />
  <meta property="og:description"
    content="Looking for rooms, hostels, flats, or PGs in Pune? Urban Pune offers verified, affordable hostels, PGs, flats, 1BHK, 2BHK & hotels for students and working professionals." />
  <meta property="og:image" content="/img/og.png" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://www.urbanpune.in/" />
  <meta name="twitter:title" content="Urban Pune - Verified Rooms, Hostels, PGs, Flats & Hotels in Pune" />
  <meta name="twitter:description"
    content="Looking for rooms, hostels, flats, or PGs in Pune? Urban Pune offers verified, affordable hostels, PGs, flats, 1BHK, 2BHK & hotels for students and working professionals." />
  <meta name="twitter:image" content="/img/og.png" />
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  
  <!-- SweetAlert2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css" rel="stylesheet" />
  
  <!-- Custom CSS -->
  <link href="css/login.css" rel="stylesheet" />
  <style>
    // Add this to your login.css or create a new CSS class
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #f3f3f3;
  border-top: 5px solid #4a6bff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <nav class="navbar navbar-expand-lg">
      <div class="container">
        <a class="navbar-brand" href="/">
          <img src="img/urbanpune.jpg" alt="Pune Rooms Logo">
        </a>
        <a href="/" class="btn btn-outline-primary">
          <i class="fas fa-arrow-left me-2"></i>Back to Home
        </a>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="flex-grow-1">
    <div class="container auth-container">
      <div class="row g-0 auth-card shadow">
        <!-- Image Column - Placed first for larger screens, will stack on mobile -->
        <div class="col-md-6 order-md-2">
          <div class="auth-image h-100">
            <div class="auth-overlay">
              <h2 class="fw-bold mb-2">Find Your Perfect Room in Pune</h2>
              <p class="mb-0">Join thousands of happy customers who found their ideal accommodation with us.</p>
            </div>
          </div>
        </div>

        <!-- Form Column -->
        <div class="col-md-6 order-md-1 bg-white p-4 p-lg-5">
          <div class="auth-tabs">
            <div class="auth-tab active" id="login-tab">Login</div>
            <div class="auth-tab" id="register-tab">Register</div>
          </div>

          <!-- Login Form -->
          <div id="login-form">
            <h1 class="fw-bold mb-4" style="font-size: 1.75rem;">Welcome back!</h1>

            <form id="loginInitForm" novalidate>
              <div class="form-floating mb-3">
                <input type="tel" class="form-control" id="loginMobile" name="mobile" placeholder="Enter Mobile Number"
                  pattern="[0-9]{10}" title="Please enter a 10-digit mobile number" required>
                <label for="loginMobile">Mobile Number</label>
                <div class="invalid-feedback">Please enter a valid 10-digit mobile number</div>
              </div>

              <button type="submit" class="btn btn-primary w-100 py-3 fw-bold">
                <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"
                  id="loginSpinner"></span>
                Send OTP
              </button>
            </form>

            <div class="text-center mt-4">
              <p>Don't have an account? <a href="#" id="show-register" class="text-primary fw-semibold">Register now</a>
              </p>
            </div>
          </div>

          <!-- Register Form -->
          <div id="register-form" style="display: none;">
            <h1 class="fw-bold mb-4" style="font-size: 1.75rem;">Create an account</h1>


            <form id="registerInitForm" novalidate>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="firstName" name="firstName" placeholder="First Name"
                      pattern="[A-Za-z]{2,}" required>
                    <label for="firstName">First Name</label>
                    <div class="invalid-feedback">Please enter a valid first name (letters only)</div>
                  </div>
                </div>

                <div class="col-md-4 mb-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Last Name"
                      pattern="[A-Za-z]{2,}" required>
                    <label for="lastName">Last Name</label>
                    <div class="invalid-feedback">Please enter a valid last name (letters only)</div>
                  </div>
                </div>

                <div class="col-md-4 mb-3">
                  <div class="form-floating">
                    <select class="form-select" id="gender" name="gender" required>
                      <option value="" selected disabled>Select Gender</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                    <label for="gender">Gender</label>
                    <div class="invalid-feedback">Please select your gender</div>
                  </div>
                </div>
              </div>

              <div class="form-floating mb-3">
                <input type="tel" class="form-control" id="phone" name="mobile" placeholder="Phone Number"
                  pattern="[0-9]{10}" title="Please enter a 10-digit phone number" required>
                <label for="phone">Phone Number</label>
                <div class="invalid-feedback">Please enter a valid 10-digit phone number</div>
              </div>

              <button type="submit" class="btn btn-primary w-100 py-3 fw-bold">
                <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"
                  id="registerSpinner"></span>
                Send OTP
              </button>
            </form>


            <div class="text-center mt-4">
              <p>Already have an account? <a href="#" id="show-login" class="text-primary fw-semibold">Login</a></p>
            </div>
          </div>

          <!-- OTP Verification Form -->
          <div id="otp-verification" class="d-none">
            <h1 class="fw-bold mb-4" style="font-size: 1.75rem;">Verify OTP</h1>
            <p class="mb-4">We've sent a 6-digit OTP to <span id="otp-mobile-number" class="fw-bold"></span></p>

            <form id="otpVerificationForm" novalidate>
              <div class="otp-container">
                <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
              </div>

              <input type="hidden" id="full-otp" name="otp">
              <input type="hidden" id="verification-mobile" name="mobile">
              <input type="hidden" id="verification-type" name="type">
              <!-- Hidden fields for registration data -->
              <input type="hidden" id="verification-firstName" name="firstName">
              <input type="hidden" id="verification-lastName" name="lastName">
              <input type="hidden" id="verification-gender" name="gender">

              <div class="resend-otp">
                <p>Didn't receive OTP? <a id="resend-otp-btn">Resend OTP</a> <span id="countdown"
                    class="countdown">(60s)</span></p>
              </div>

              <button type="submit" class="btn btn-primary w-100 py-3 fw-bold">
                <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"
                  id="verifySpinner"></span>
                Verify & Continue
              </button>
            </form>

            <div class="text-center mt-4">
              <a href="#" id="back-to-forms" class="text-primary fw-semibold">
                <i class="fas fa-arrow-left me-2"></i>Back to login
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer bg-dark text-white py-3 text-center">
    <div class="container">
      <p class="mb-0">&copy; 2025 Pune Rooms. All rights reserved.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // API URL - Change this to your actual backend URL
      const API_URL = '/api'; // FIXED: Changed to relative URL for better compatibility




      // API URL - Change this to your actual backend URL

      // Function to check authentication status
      async function checkAuthStatus() {
        try {
          const response = await fetch(`/check-auth`, {
            method: 'GET',
            credentials: 'include' // Important for cookies
          });

          const data = await response.json();

          if (data.authenticated) {
            // Redirect to rooms if logged in
            window.location.href = data.redirectTo || '/rooms';
          }
          // If not authenticated, just continue showing login page
        } catch (error) {
          console.error('Auth check failed:', error);
          // Continue with page load even if check fails
        }
      }

      // Call this when page loads
        checkAuthStatus();
      

      // DOM Elements
      const loginTab = document.getElementById('login-tab');
      const registerTab = document.getElementById('register-tab');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const otpVerification = document.getElementById('otp-verification');
      const showLogin = document.getElementById('show-login');
      const showRegister = document.getElementById('show-register');
      const backToForms = document.getElementById('back-to-forms');
      const otpMobileNumber = document.getElementById('otp-mobile-number');
      const verificationMobile = document.getElementById('verification-mobile');
      const verificationType = document.getElementById('verification-type');
      const verificationFirstName = document.getElementById('verification-firstName');
      const verificationLastName = document.getElementById('verification-lastName');
      const verificationGender = document.getElementById('verification-gender');
      const resendOtpBtn = document.getElementById('resend-otp-btn');
      const countdownElement = document.getElementById('countdown');
      const fullOtpInput = document.getElementById('full-otp');
      const loginSpinner = document.getElementById('loginSpinner');
      const registerSpinner = document.getElementById('registerSpinner');
      const verifySpinner = document.getElementById('verifySpinner');

      // Tab switching functions
      function switchToLogin() {
        loginTab.classList.add('active');
        registerTab.classList.remove('active');
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        otpVerification.classList.add('d-none');
        document.getElementById('loginInitForm').reset();
        document.getElementById('registerInitForm').reset();
        resetOtpInputs();
      }

      function switchToRegister() {
        registerTab.classList.add('active');
        loginTab.classList.remove('active');
        registerForm.style.display = 'block';
        loginForm.style.display = 'none';
        otpVerification.classList.add('d-none');
        document.getElementById('loginInitForm').reset();
        document.getElementById('registerInitForm').reset();
        resetOtpInputs();
      }

      // Event listeners for tab switching
      loginTab.addEventListener('click', switchToLogin);
      registerTab.addEventListener('click', switchToRegister);
      showLogin.addEventListener('click', function (e) {
        e.preventDefault();
        switchToLogin();
      });
      showRegister.addEventListener('click', function (e) {
        e.preventDefault();
        switchToRegister();
      });
      backToForms.addEventListener('click', function (e) {
        e.preventDefault();
        if (verificationType.value === 'login') {
          switchToLogin();
        } else {
          switchToRegister();
        }
      });

      // OTP Input Handling
      const otpInputs = document.querySelectorAll('.otp-input');

      otpInputs.forEach((input, index) => {
        // Handle input
        input.addEventListener('input', function (e) {
          // Allow only numbers
          this.value = this.value.replace(/[^0-9]/g, '');

          if (this.value.length === 1) {
            if (index < otpInputs.length - 1) {
              otpInputs[index + 1].focus();
            }
          }
          updateFullOtp();
        });

        // Handle paste event for OTP
        input.addEventListener('paste', function (e) {
          e.preventDefault();
          const pastedData = (e.clipboardData || window.clipboardData).getData('text');
          const numericData = pastedData.replace(/[^0-9]/g, '').substring(0, 6);

          if (numericData.length > 0) {
            // Fill all inputs with pasted data
            for (let i = 0; i < otpInputs.length; i++) {
              if (i < numericData.length) {
                otpInputs[i].value = numericData[i];
              }
            }

            // Focus on the appropriate input
            if (numericData.length < otpInputs.length) {
              otpInputs[numericData.length].focus();
            } else {
              otpInputs[otpInputs.length - 1].focus();
            }

            updateFullOtp();
          }
        });

        // Handle backspace
        input.addEventListener('keydown', function (e) {
          if (e.key === 'Backspace' && this.value.length === 0) {
            if (index > 0) {
              otpInputs[index - 1].focus();
            }
          }
        });
      });

      function updateFullOtp() {
        let otp = '';
        otpInputs.forEach(input => {
          otp += input.value;
        });
        fullOtpInput.value = otp;
      }

      function resetOtpInputs() {
        otpInputs.forEach(input => {
          input.value = '';
        });
        fullOtpInput.value = '';
      }

      // Initialize OTP verification
      function initOtpVerification(mobile, type, firstName = '', lastName = '', gender = '') {
        loginForm.style.display = 'none';
        registerForm.style.display = 'none';
        otpVerification.classList.remove('d-none');

        otpMobileNumber.textContent = mobile;
        verificationMobile.value = mobile;
        verificationType.value = type;

        // Store registration data if available
        if (type === 'register') {
          verificationFirstName.value = firstName;
          verificationLastName.value = lastName;
          verificationGender.value = gender;
        }

        // Focus on first OTP input
        otpInputs[0].focus();

        startCountdown();
      }

      // Countdown timer for resend OTP
      let countdownInterval;
      function startCountdown() {
        clearInterval(countdownInterval);

        let timeLeft = 60;
        resendOtpBtn.style.pointerEvents = 'none';
        resendOtpBtn.style.opacity = '0.5';
        countdownElement.textContent = `(${timeLeft}s)`;

        countdownInterval = setInterval(() => {
          timeLeft--;
          countdownElement.textContent = `(${timeLeft}s)`;

          if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            resendOtpBtn.style.pointerEvents = 'auto';
            resendOtpBtn.style.opacity = '1';
            countdownElement.textContent = '';
          }
        }, 1000);
      }

      // Helper function to clean mobile number
      function cleanMobileNumber(mobile) {
        if (!mobile) return '';
        return String(mobile).replace(/\D/g, '').substring(0, 10);
      }

      // Handle resend OTP
      resendOtpBtn.addEventListener('click', async function (e) {
        e.preventDefault();
        if (this.style.pointerEvents === 'none') return;

        const mobile = verificationMobile.value;
        const type = verificationType.value;
        const firstName = verificationFirstName.value;
        const lastName = verificationLastName.value;
        const gender = verificationGender.value;
        const cleanedMobile = cleanMobileNumber(mobile);

        // Show loading state
        this.style.pointerEvents = 'none';
        this.style.opacity = '0.5';

        try {
          // FIXED: Proper request body structure
          const requestBody = {
            mobile: cleanedMobile,
            type: type
          };

          // Add firstName and lastName for registration
          if (type === 'register') {
            requestBody.firstName = firstName;
            requestBody.lastName = lastName;
            requestBody.gender = gender;
          }

          const response = await fetch(`${API_URL}/send-otp`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestBody),
            credentials: 'include' // FIXED: Include credentials for session cookies
          });

          const data = await response.json();

          if (data.success) {
            // Show success notification
            Swal.fire({
              title: 'OTP Resent!',
              text: `A new verification code has been sent to ${mobile}`,
              icon: 'success',
              confirmButtonColor: '#4a6bff',
              timer: 3000,
              timerProgressBar: true
            });

            startCountdown();
            resetOtpInputs();
            otpInputs[0].focus();
          } else {
            // Show error notification
            Swal.fire({
              title: 'Error',
              text: data.message || 'Failed to resend OTP',
              icon: 'error',
              confirmButtonColor: '#4a6bff'
            });

            // Reset resend button
            this.style.pointerEvents = 'auto';
            this.style.opacity = '1';
          }
        } catch (error) {
          console.error('Error resending OTP:', error);

          // Show error notification
          Swal.fire({
            title: 'Error',
            text: 'Failed to connect to server',
            icon: 'error',
            confirmButtonColor: '#4a6bff'
          });

          // Reset resend button
          this.style.pointerEvents = 'auto';
          this.style.opacity = '1';
        }
      });

      // Form submissions
      document.getElementById('loginInitForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        this.classList.add('was-validated');

        if (this.checkValidity()) {
          const mobile = document.getElementById('loginMobile').value;
          const cleanedMobile = cleanMobileNumber(mobile);

          // Show loading state
          loginSpinner.classList.remove('d-none');

          try {
            const response = await fetch(`${API_URL}/send-otp`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                mobile: cleanedMobile,
                type: 'login'
              }),
              credentials: 'include' // FIXED: Include credentials for session cookies
            });

            const data = await response.json();

            // Hide loading state
            loginSpinner.classList.add('d-none');

            if (data.success) {
              // Show success notification
              Swal.fire({
                title: 'OTP Sent!',
                text: `A verification code has been sent to ${mobile}`,
                icon: 'success',
                confirmButtonColor: '#4a6bff',
                timer: 3000,
                timerProgressBar: true
              });

              initOtpVerification(cleanedMobile, 'login');
            } else {
              // Show error notification
              Swal.fire({
                title: 'Error',
                text: data.message || 'Failed to send OTP',
                icon: 'error',
                confirmButtonColor: '#4a6bff'
              });
            }
          } catch (error) {
            console.error('Error sending OTP:', error);

            // Hide loading state
            loginSpinner.classList.add('d-none');

            // Show error notification
            Swal.fire({
              title: 'Error',
              text: 'Failed to connect to server',
              icon: 'error',
              confirmButtonColor: '#4a6bff'
            });
          }
        }
      });

      document.getElementById('registerInitForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        this.classList.add('was-validated');

        if (this.checkValidity()) {
          const mobile = document.getElementById('phone').value;
          const firstName = document.getElementById('firstName').value;
          const lastName = document.getElementById('lastName').value;
          const gender = document.getElementById('gender').value;
          const cleanedMobile = cleanMobileNumber(mobile);

          // Show loading state
          registerSpinner.classList.remove('d-none');

          try {
            const response = await fetch(`${API_URL}/send-otp`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                mobile: cleanedMobile,
                type: 'register',
                firstName,
                lastName,
                gender
              }),
              credentials: 'include' // FIXED: Include credentials for session cookies
            });

            const data = await response.json();

            // Hide loading state
            registerSpinner.classList.add('d-none');

            if (data.success) {
              // Show success notification
              Swal.fire({
                title: 'OTP Sent!',
                text: `A verification code has been sent to ${mobile}`,
                icon: 'success',
                confirmButtonColor: '#4a6bff',
                timer: 3000,
                timerProgressBar: true
              });

              initOtpVerification(cleanedMobile, 'register', firstName, lastName, gender);
            } else {
              // Show error notification
              Swal.fire({
                title: 'Error',
                text: data.message || 'Failed to send OTP',
                icon: 'error',
                confirmButtonColor: '#4a6bff'
              });
            }
          } catch (error) {
            console.error('Error sending OTP:', error);

            // Hide loading state
            registerSpinner.classList.add('d-none');

            // Show error notification
            Swal.fire({
              title: 'Error',
              text: 'Failed to connect to server',
              icon: 'error',
              confirmButtonColor: '#4a6bff'
            });
          }
        }
      });

      document.getElementById('otpVerificationForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const otp = fullOtpInput.value;
        const mobile = verificationMobile.value;
        const type = verificationType.value;
        const firstName = verificationFirstName.value;
        const lastName = verificationLastName.value;
        const gender = verificationGender.value;
        const cleanedMobile = cleanMobileNumber(mobile);

        if (otp.length !== 6) {
          Swal.fire({
            title: 'Invalid OTP',
            text: 'Please enter a 6-digit OTP',
            icon: 'error',
            confirmButtonColor: '#4a6bff'
          });
          return;
        }

        // Show loading state
        verifySpinner.classList.remove('d-none');

        try {
          // FIXED: Proper request body structure
          const requestBody = {
            mobile: cleanedMobile,
            otp: otp,
            type: type
          };

          // Add firstName, lastName and gender for registration
          if (type === 'register') {
            requestBody.firstName = firstName;
            requestBody.lastName = lastName;
            requestBody.gender = gender;
          }

          const response = await fetch(`${API_URL}/verify-otp`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestBody),
            credentials: 'include' // FIXED: Include credentials for session cookies
          });

          const data = await response.json();

          // Hide loading state
          verifySpinner.classList.add('d-none');

          if (data.success) {
            Swal.fire({
              title: 'Success!',
              text: 'Verification successful! Redirecting...',
              icon: 'success',
              confirmButtonColor: '#4a6bff',
              timer: 2000,
              timerProgressBar: true
            }).then(() => {
              // FIXED: Redirect to rooms page instead of dashboard
              window.location.href = data.redirectTo || '/rooms';
            });
          } else {
            Swal.fire({
              title: 'Invalid OTP',
              text: data.message || 'The OTP you entered is incorrect. Please try again.',
              icon: 'error',
              confirmButtonColor: '#4a6bff'
            });
            resetOtpInputs();
            otpInputs[0].focus();
          }
        } catch (error) {
          console.error('Error verifying OTP:', error);

          // Hide loading state
          verifySpinner.classList.add('d-none');

          // Show error notification
          Swal.fire({
            title: 'Error',
            text: 'Failed to connect to server',
            icon: 'error',
            confirmButtonColor: '#4a6bff'
          });
        }
      });

      // Mobile number validation
      const phoneInputs = document.querySelectorAll('input[type="tel"]');
      phoneInputs.forEach(input => {
        input.addEventListener('input', function () {
          this.value = this.value.replace(/[^0-9]/g, '').substring(0, 10);
        });
      });

      // Name validation
      const nameInputs = document.querySelectorAll('#firstName, #lastName');
      nameInputs.forEach(input => {
        input.addEventListener('input', function () {
          this.value = this.value.replace(/[^A-Za-z\s]/g, '');
        });
      });

      // Prevent form submission on Enter key for OTP inputs
      otpInputs.forEach(input => {
        input.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            if (fullOtpInput.value.length === 6) {
              document.getElementById('otpVerificationForm').dispatchEvent(new Event('submit'));
            }
          }
        });
      });

      // Check for URL parameters to show error messages
      function checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const msg = urlParams.get('msg');

        if (msg) {
          let title = 'Notice';
          let text = '';
          let icon = 'info';

          switch (msg) {
            case 'logged_out':
              text = 'You have been successfully logged out.';
              icon = 'success';
              break;
            case 'session_error':
              text = 'There was an error with your session. Please login again.';
              icon = 'error';
              break;
            case 'invalid':
              text = 'Invalid credentials. Please try again.';
              icon = 'error';
              break;
            case 'invalid_mobile':
              text = 'Please enter a valid 10-digit mobile number.';
              icon = 'warning';
              break;
            case 'duplicate':
              text = 'This mobile number is already registered. Please login instead.';
              icon = 'warning';
              switchToLogin();
              break;
            case 'Please login first':
              text = 'Please login to access that page.';
              icon = 'info';
              break;
            default:
              text = msg;
          }

          Swal.fire({
            title,
            text,
            icon,
            confirmButtonColor: '#4a6bff',
            timer: 3000,
            timerProgressBar: true
          });
        }
      }

      // Check URL parameters on page load
      checkUrlParams();

      console.log('Login page loaded and ready for production');
    });

  </script>
</body>

</html>